# Packages: isort for formatting imports, black for formatting code
# pylint for linting code and pytest for testing code in test dir

name: Code Prep - Format, lint and test

on:
  pull_request:
    branches: [master, main]
  push:
    branches: [master, main]

jobs:
  fix-code: # job name
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3 # use a github action
      
      - name: Python Linter
        uses: sunnysid3up/python-linter@v0.1-beta.7
        with:
          source: "app"
          strict: "low"
          mypy-options: "--ignore-missing-imports --show-error-codes"
          pylint-options: "--rcfile=.pylintrc"
          isort-options: "-w 100"

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3 # use a github action
      - uses: actions/setup-python@v4
        with:
          python-version: 3.11
          - name: Install dependencies
          run: python -m pip install pytest -r requirements.dev.txt
      
      - name: Test with pytest
        run: pytest